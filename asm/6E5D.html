<!DOCTYPE html>
<html>
<head>
<title>Percy the Potty Pigeon: Routine at 6E5D</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6E2F.html">6E2F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6e5d">Map</a></td>
<td class="next">
Next: <a href="6F13.html">6F13</a>
</td>
</tr>
</table>
<div class="description">6E5D: Handler: Car Type 1 (Driving Right)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="6DAB.html">Dispatch_Game_State</a>.
</div>
<div class="paragraph">
Handles a car driving right across the screen. The car is made up of two sprites (10 pixels apart) representing the front and back.
</div>
<div class="paragraph">
When the car reaches the right edge it is reinitialised from a random position.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Car_Type1</td>
<td class="address-2"><span id="6e5d"></span>6E5D</td>
<td class="instruction">LD IX,$DAC8</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=<a href="DAC8.html">Sprite02_3Wide_X_Position</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e61"></span>6E61</td>
<td class="instruction">LD A,($5FBB)</td>
<td class="comment-1" rowspan="3">Call <a href="6F13.html">InitialiseCar</a> if *<a href="5FBB.html">RoomBufferFlag</a> is set/ the room is being initialised.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e64"></span>6E64</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e65"></span>6E65</td>
<td class="instruction">CALL NZ,<a href="6F13.html">InitialiseCar</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e68"></span>
<div class="comments">
<div class="paragraph">
If the car crash timer is active, handle the crash animation.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e68"></span>6E68</td>
<td class="instruction">LD A,($7208)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="7208.html">CarCrashTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6b"></span>6E6B</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Jump to <a href="6E5D.html#6e97">Handler_CarType1_Drive</a> if the crash timer is zero (car is driving normally).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6c"></span>6E6C</td>
<td class="instruction">JR Z,<a href="6E5D.html#6e97">Handler_CarType1_Drive</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e6e"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="6F8D.html">Handler_CarType2</a> and <a href="7028.html">Handler_CarType3</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Car_Type1_0</td>
<td class="address-2"><span id="6e6e"></span>6E6E</td>
<td class="instruction">CP $01</td>
<td class="comment-1" rowspan="2">Jump to <a href="6E5D.html#6e91">Handler_CarType1_CrashEnd</a> if the crash timer has reached 01 (crash ending).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e70"></span>6E70</td>
<td class="instruction">JR Z,<a href="6E5D.html#6e91">Handler_CarType1_CrashEnd</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e72"></span>
<div class="comments">
<div class="paragraph">
Car is crashing — decrement the timer and cycle through crash animation frames.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e72"></span>6E72</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrement the crash timer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e73"></span>6E73</td>
<td class="instruction">LD ($7208),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<a href="7208.html">CarCrashTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e76"></span>6E76</td>
<td class="instruction">AND %00000010</td>
<td class="comment-1" rowspan="1">Keep only bit 1 (alternates between 00 and 02).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e78"></span>6E78</td>
<td class="instruction">ADD A,$20</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=20 (crash frame base).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e7a"></span>6E7A</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Stash the frame in shadow <span class="register">AF</span>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e7b"></span>
<div class="comments">
<div class="paragraph">
If the car is on the lower road (Y=A0), use a different frame set.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e7b"></span>6E7B</td>
<td class="instruction">LD A,(IX+$01)</td>
<td class="comment-1" rowspan="1">Load <span class="register">A</span> with the car's Y position (from *<span class="register">IX</span>+01).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e7e"></span>6E7E</td>
<td class="instruction">CP $A0</td>
<td class="comment-1" rowspan="2">Jump to <a href="6E5D.html#6e87">Handler_CarType1_SetCrashFrame</a> if the car is not on the lower road.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e80"></span>6E80</td>
<td class="instruction">JR NZ,<a href="6E5D.html#6e87">Handler_CarType1_SetCrashFrame</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e82"></span>6E82</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Retrieve the crash frame from shadow <span class="register">AF</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e83"></span>6E83</td>
<td class="instruction">ADD A,$02</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=02 (offset to left-facing crash frames).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e85"></span>6E85</td>
<td class="instruction">JR <a href="6E5D.html#6e88">Handler_CarType1_StoreCrashFrame</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6E5D.html#6e88">Handler_CarType1_StoreCrashFrame</a>.</td>
</tr>
<tr>
<td class="asm-label">Handler_CarType1_SetCrashFrame</td>
<td class="address-2"><span id="6e87"></span>6E87</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Retrieve the crash frame from shadow <span class="register">AF</span>.</td>
</tr>
<tr>
<td class="asm-label">Handler_CarType1_StoreCrashFrame</td>
<td class="address-2"><span id="6e88"></span>6E88</td>
<td class="instruction">LD (IX+$03),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+03 (front sprite frame).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e8b"></span>6E8B</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment <span class="register">A</span> for the rear sprite.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e8c"></span>6E8C</td>
<td class="instruction">LD (IX+$07),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+07 (rear sprite frame).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e8f"></span>6E8F</td>
<td class="instruction">JR <a href="6E5D.html#6eef">Handler_CarCheckPercyCollision</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6E5D.html#6eef">Handler_CarCheckPercyCollision</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e91"></span>
<div class="comments">
<div class="paragraph">
Crash animation finished — clear the timer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_CarType1_CrashEnd</td>
<td class="address-2"><span id="6e91"></span>6E91</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write 00 to *<a href="7208.html">CarCrashTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e92"></span>6E92</td>
<td class="instruction">LD ($7208),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e95"></span>6E95</td>
<td class="instruction">JR <a href="6E5D.html#6eef">Handler_CarCheckPercyCollision</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6E5D.html#6eef">Handler_CarCheckPercyCollision</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e97"></span>
<div class="comments">
<div class="paragraph">
Car is driving normally — move it to the right.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_CarType1_Drive</td>
<td class="address-2"><span id="6e97"></span>6E97</td>
<td class="instruction">LD HL,$720C</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="7208.html#720c">CarSpeed2</a> (car speed).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e9a"></span>6E9A</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">IX</span>+00 (car X position).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e9d"></span>6E9D</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=*<span class="register">HL</span> (add speed).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e9e"></span>6E9E</td>
<td class="instruction">CP $DE</td>
<td class="comment-1" rowspan="2">Call <a href="6F13.html">InitialiseCar</a> to reinitialise the car if it's at the right edge.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea0"></span>6EA0</td>
<td class="instruction">CALL NC,<a href="6F13.html">InitialiseCar</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ea3"></span>
<div class="comments">
<div class="paragraph">
Update both sprite X positions (10 apart).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea3"></span>6EA3</td>
<td class="instruction">LD (IX+$00),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+00 (front X).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea6"></span>6EA6</td>
<td class="instruction">ADD A,$10</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=10.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea8"></span>6EA8</td>
<td class="instruction">LD (IX+$04),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+04 (rear X).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6eab"></span>
<div class="comments">
<div class="paragraph">
Set the driving right frames.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eab"></span>6EAB</td>
<td class="instruction">LD (IX+$03),$1C</td>
<td class="comment-1" rowspan="1">Write 1C to *<span class="register">IX</span>+03 (front frame: driving right).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eaf"></span>6EAF</td>
<td class="instruction">LD (IX+$07),$1D</td>
<td class="comment-1" rowspan="1">Write 1D to *<span class="register">IX</span>+07 (rear frame: driving right).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6eb3"></span>
<div class="comments">
<div class="paragraph">
Set the car colour for both sprites.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eb3"></span>6EB3</td>
<td class="instruction">LD A,($720A)</td>
<td class="comment-1" rowspan="3">Write *<a href="7208.html#720a">CarColour</a> to; <ul class="">
<li>*<span class="register">IX</span>+02 (front colour)</li>
<li>*<span class="register">IX</span>+06 (rear colour)</li>
</ul></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eb6"></span>6EB6</td>
<td class="instruction">LD (IX+$02),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eb9"></span>6EB9</td>
<td class="instruction">LD (IX+$06),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ebc"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="6F8D.html">Handler_CarType2</a>.
</div>
<div class="paragraph">
Set the Y positions for the wheels/underside sprites.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Car_Type1_1</td>
<td class="address-2"><span id="6ebc"></span>6EBC</td>
<td class="instruction">LD (IX+$21),$A0</td>
<td class="comment-1" rowspan="1">Write A0 to *<span class="register">IX</span>+21 (front underside Y).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec0"></span>6EC0</td>
<td class="instruction">LD (IX+$25),$A0</td>
<td class="comment-1" rowspan="1">Write A0 to *<span class="register">IX</span>+25 (rear underside Y).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ec4"></span>
<div class="comments">
<div class="paragraph">
Set the X positions for the underside sprites (offset by 03 and 18 from the car's X).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec4"></span>6EC4</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">IX</span>+00.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec7"></span>6EC7</td>
<td class="instruction">ADD A,$03</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=03.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec9"></span>6EC9</td>
<td class="instruction">LD (IX+$20),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+20 (front underside X).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ecc"></span>6ECC</td>
<td class="instruction">ADD A,$15</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=15.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ece"></span>6ECE</td>
<td class="instruction">LD (IX+$24),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+24 (rear underside X).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ed1"></span>
<div class="comments">
<div class="paragraph">
Animate the wheels — cycle through frames 10-13.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed1"></span>6ED1</td>
<td class="instruction">LD HL,$720D</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="7208.html#720d">CarWheelAnimation</a> (wheel animation counter).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed4"></span>6ED4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed5"></span>6ED5</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment the counter.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed6"></span>6ED6</td>
<td class="instruction">AND %00000011</td>
<td class="comment-1" rowspan="1">Keep only bits 0-1 (cycle 00-03).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed8"></span>6ED8</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write back to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed9"></span>6ED9</td>
<td class="instruction">ADD A,$10</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=10 (wheel frame base).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6edb"></span>6EDB</td>
<td class="instruction">LD (IX+$23),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+23 (front wheel frame).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ede"></span>
<div class="comments">
<div class="paragraph">
Offset the rear wheel animation by 02 for visual variety.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ede"></span>6EDE</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6edf"></span>6EDF</td>
<td class="instruction">ADD A,$02</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=02.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ee1"></span>6EE1</td>
<td class="instruction">AND %00000011</td>
<td class="comment-1" rowspan="1">Keep only bits 0-1.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ee3"></span>6EE3</td>
<td class="instruction">ADD A,$10</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=10 (wheel frame base).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ee5"></span>6EE5</td>
<td class="instruction">LD (IX+$27),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+27 (rear wheel frame).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ee8"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="6F8D.html">Handler_CarType2</a>.
</div>
<div class="paragraph">
Check if Percy's egg has hit the car.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Car_Type1_2</td>
<td class="address-2"><span id="6ee8"></span>6EE8</td>
<td class="instruction">LD A,($5FA9)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="5FA9.html">EggDropFlag</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eeb"></span>6EEB</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Call <a href="6F54.html">CheckCarEggCollision</a> if the egg is active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eec"></span>6EEC</td>
<td class="instruction">CALL NZ,<a href="6F54.html">CheckCarEggCollision</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6eef"></span>
<div class="comments">
<div class="paragraph">
Check if the car has collided with Percy.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_CarCheckPercyCollision</td>
<td class="address-2"><span id="6eef"></span>6EEF</td>
<td class="instruction">LD IX,$DAC0</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=<a href="DAC0.html">Percy_X_Position</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ef3"></span>6EF3</td>
<td class="instruction">LD IY,$DACC</td>
<td class="comment-1" rowspan="1"><span class="register">IY</span>=<a href="DACC.html">Sprite03_3Wide_X_Position</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ef7"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="6DAB.html">Dispatch_Game_State</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_CarCheckPercyCollision_Test</td>
<td class="address-2"><span id="6ef7"></span>6EF7</td>
<td class="instruction">CALL <a href="6C53.html">CheckSpriteCollision</a></td>
<td class="comment-1" rowspan="1">Call <a href="6C53.html">CheckSpriteCollision</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6efa"></span>6EFA</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return if no collision.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6efb"></span>
<div class="comments">
<div class="paragraph">
Car hit Percy — knock him backward.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_CarKnockBackPercy</td>
<td class="address-1"><span id="6efb"></span>6EFB</td>
<td class="instruction">LD HL,$DAC0</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="DAC0.html">Percy_X_Position</a> (Percy's X position).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6efe"></span>6EFE</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eff"></span>6EFF</td>
<td class="instruction">SUB $14</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>-=14 (knock back distance).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f01"></span>6F01</td>
<td class="instruction">JR C,<a href="6E5D.html#6f0b">Handler_CarKnockBackPercy_LeftEdge</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6E5D.html#6f0b">Handler_CarKnockBackPercy_LeftEdge</a> if the result underflowed (Percy at the left edge).</td>
</tr>
<tr>
<td class="asm-label">Handler_Car_Type1_3</td>
<td class="address-2"><span id="6f03"></span>6F03</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the new X position to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f04"></span>6F04</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Advance to Percy's Y position.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f05"></span>6F05</td>
<td class="instruction">LD (HL),$78</td>
<td class="comment-1" rowspan="1">Write 78 to *<span class="register">HL</span> (set Percy's Y position after knockback).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f07"></span>6F07</td>
<td class="instruction">LD ($5FA7),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<a href="5FA7.html">FallingState</a> (set the falling state).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f0a"></span>6F0A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f0b"></span>
<div class="comments">
<div class="paragraph">
Percy was too close to the left edge — adjust position rightward.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_CarKnockBackPercy_LeftEdge</td>
<td class="address-2"><span id="6f0b"></span>6F0B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f0c"></span>6F0C</td>
<td class="instruction">ADD A,$0A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=0A.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f0e"></span>6F0E</td>
<td class="instruction">JR <a href="6E5D.html#6f03">Handler_Car_Type1_3</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6E5D.html#6f03">Handler_Car_Type1_3</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f10"></span>
<div class="comments">
<div class="paragraph">
Alternate entry point for car initialisation.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">InitialiseCar_Alternate</td>
<td class="address-1"><span id="6f10"></span>6F10</td>
<td class="instruction">CALL <a href="6F13.html">InitialiseCar</a></td>
<td class="comment-1" rowspan="1">Call <a href="6F13.html">InitialiseCar</a>.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6E2F.html">6E2F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6e5d">Map</a></td>
<td class="next">
Next: <a href="6F13.html">6F13</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 2026 Urbanscan<br />&copy; 1984 Gremlin Graphics Software Ltd<br />&copy; 2026 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/percythepottypigeon/">Source code</a>.</div>
<div><a href="../dec/asm/28253.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>