<!DOCTYPE html>
<html>
<head>
<title>Percy the Potty Pigeon: Routine at 6F13</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6E5D.html">6E5D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f13">Map</a></td>
<td class="next">
Next: <a href="6F54.html">6F54</a>
</td>
</tr>
</table>
<div class="description">6F13: Initialise Car</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="6E5D.html">Handler_Car_Type1</a>.
</div>
<div class="paragraph">
Initialises a car with random speed, colour and position. The car starts at Y=90 (upper road) with the possibility of appearing at different X positions.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Pointer to car sprite data</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">InitialiseCar</td>
<td class="address-2"><span id="6f13"></span>6F13</td>
<td class="instruction">CALL <a href="6C39.html">GenerateRandomNumber</a></td>
<td class="comment-1" rowspan="1">Call <a href="6C39.html">GenerateRandomNumber</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f16"></span>6F16</td>
<td class="instruction">AND %00000011</td>
<td class="comment-1" rowspan="1">Keep only bits 0-1 (random speed 00-03).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f18"></span>6F18</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment (speed 01-04).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f19"></span>6F19</td>
<td class="instruction">LD ($720C),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<a href="7208.html#720c">CarSpeed2</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f1c"></span>
<div class="comments">
<div class="paragraph">
Set a random appearance delay if the room is valid.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f1c"></span>6F1C</td>
<td class="instruction">LD A,($5FC5)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="5FC5.html">CurrentRoom</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f1f"></span>6F1F</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Jump to <a href="6F13.html#6f2c">InitialiseCar_PickColour</a> if the room number is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f20"></span>6F20</td>
<td class="instruction">JR Z,<a href="6F13.html#6f2c">InitialiseCar_PickColour</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f22"></span>6F22</td>
<td class="instruction">CALL <a href="6C39.html">GenerateRandomNumber</a></td>
<td class="comment-1" rowspan="1">Call <a href="6C39.html">GenerateRandomNumber</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f25"></span>6F25</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f27"></span>6F27</td>
<td class="instruction">OR %00000001</td>
<td class="comment-1" rowspan="1">Set bit 0 (ensure odd value).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f29"></span>6F29</td>
<td class="instruction">LD ($720E),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<a href="7208.html#720e">CarAppearanceDelay</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f2c"></span>
<div class="comments">
<div class="paragraph">
Pick a random colour, but reject colour 01 (blue).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">InitialiseCar_PickColour</td>
<td class="address-2"><span id="6f2c"></span>6F2C</td>
<td class="instruction">CALL <a href="6C39.html">GenerateRandomNumber</a></td>
<td class="comment-1" rowspan="1">Call <a href="6C39.html">GenerateRandomNumber</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f2f"></span>6F2F</td>
<td class="instruction">AND %00000011</td>
<td class="comment-1" rowspan="1">Keep only bits 0-1 (random colour 00-03).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f31"></span>6F31</td>
<td class="instruction">CP $01</td>
<td class="comment-1" rowspan="2">Jump to <a href="6F13.html#6f2c">InitialiseCar_PickColour</a> if the colour is BLUE (pick again).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f33"></span>6F33</td>
<td class="instruction">JR Z,<a href="6F13.html#6f2c">InitialiseCar_PickColour</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f35"></span>6F35</td>
<td class="instruction">LD ($720A),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<a href="7208.html#720a">CarColour</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f38"></span>
<div class="comments">
<div class="paragraph">
Clear the crash timer and set the car on the upper road.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f38"></span>6F38</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write 00 to *<a href="7208.html">CarCrashTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f39"></span>6F39</td>
<td class="instruction">LD ($7208),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f3c"></span>6F3C</td>
<td class="instruction">LD (IX+$01),$90</td>
<td class="comment-1" rowspan="1">Write 90 to *<span class="register">IX</span>+01 (front Y: upper road).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f40"></span>6F40</td>
<td class="instruction">LD (IX+$05),$90</td>
<td class="comment-1" rowspan="1">Write 90 to *<span class="register">IX</span>+05 (rear Y: upper road).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f44"></span>6F44</td>
<td class="instruction">LD (IX+$22),$07</td>
<td class="comment-1" rowspan="1">Write 07 to *<span class="register">IX</span>+22 (front wheel colour: white).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f48"></span>6F48</td>
<td class="instruction">LD (IX+$26),$07</td>
<td class="comment-1" rowspan="1">Write 07 to *<span class="register">IX</span>+26 (rear wheel colour: white).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f4c"></span>
<div class="comments">
<div class="paragraph">
If the car's X position is past 64 reset it to the left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f4c"></span>6F4C</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="1">Load <span class="register">A</span> with the car's X position (from *<span class="register">IX</span>+00).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f4f"></span>6F4F</td>
<td class="instruction">CP $64</td>
<td class="comment-1" rowspan="2">Return if the car's X position is less than 64 (position is valid).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f51"></span>6F51</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f52"></span>6F52</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=00 (reset X position to the left edge).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6f53"></span>6F53</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6E5D.html">6E5D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f13">Map</a></td>
<td class="next">
Next: <a href="6F54.html">6F54</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 2026 Urbanscan<br />&copy; 1984 Gremlin Graphics Software Ltd<br />&copy; 2026 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/percythepottypigeon/">Source code</a>.</div>
<div><a href="../dec/asm/28435.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>